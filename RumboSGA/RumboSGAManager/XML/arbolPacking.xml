<?xml version="1.0" encoding="utf-8" ?>
<arbol>
  <nivel1>
  SELECT DISTINCT RU.IDRUTA, RU.CODIGO,RU.DESCRIPCION 
  FROM dbo.TBLPACKINGLIST PL 
  INNER  JOIN dbo.TBLSALIDAS S ON S.IDENTIFICADORPL = PL.IDENTIFICADOR 
  INNER JOIN dbo.TBLPEDIDOSCLICAB PC ON S.IDPEDIDOCLI=PC.IDPEDIDOCLI 
  INNER JOIN dbo.TBLRUTAS RU ON PC.IDRUTA = RU.IDRUTA  
  INNER JOIN TBLORDENRECOGIDALIN OL ON S.IDORDENRECOGIDA=OL.IDORDENRECOGIDA AND S.IDPEDIDOCLI=OL.IDPEDIDOCLI AND S.IDPEDIDOCLILIN=OL.IDPEDIDOCLILIN 
  INNER JOIN TBLORDENRECOGIDACAB OC ON OC.IDORDENRECOGIDA = OL.IDORDENRECOGIDA left join dbo.tblcargalin cl on cl.identificador=pl.identificador 
  where PL.IDPACKINGESTADO='PK' AND OC.IDORDENESTADO NOT IN ('PS','PA','PH')  AND (cl.idcarga is null or ISNULL(s.idcarga,0)=0) 
  order by RU.idruta
</nivel1>
  <nivel2>select distinct C.IDCLIENTE,C.CODIGO,C.NOMBRE,PC.IDRUTA 
  FROM dbo.TBLPACKINGLIST PL 
  INNER JOIN dbo.TBLSALIDAS S ON S.IDENTIFICADORPL = PL.IDENTIFICADOR 
  INNER JOIN dbo.TBLPEDIDOSCLICAB PC ON S.IDPEDIDOCLI=PC.IDPEDIDOCLI 
  INNER JOIN dbo.TBLCLIENTES C ON PC.IDCLIENTE=C.IDCLIENTE 
  INNER JOIN TBLORDENRECOGIDALIN OL ON S.IDORDENRECOGIDA=OL.IDORDENRECOGIDA AND S.IDPEDIDOCLI=OL.IDPEDIDOCLI AND S.IDPEDIDOCLILIN=OL.IDPEDIDOCLILIN 
  INNER JOIN TBLORDENRECOGIDACAB OC ON OC.IDORDENRECOGIDA = OL.IDORDENRECOGIDA left join dbo.tblcargalin cl on cl.identificador=pl.identificador 
  WHERE PL.IDPACKINGESTADO='PK' AND OC.IDORDENESTADO NOT IN ('PS','PA','PH') and (cl.idcarga is null or ISNULL(s.idcarga,0)=0) 
  ORDER by C.IDCLIENTE
</nivel2>
  <nivel3>
    select distinct PC.IDPEDIDOCLI,PC.REFERENCIA,PC.SERIE,PC.IDCLIENTE 
    FROM dbo.TBLPACKINGLIST PL 
    INNER JOIN dbo.TBLSALIDAS S ON S.IDENTIFICADORPL=PL.IDENTIFICADOR 
    INNER JOIN dbo.TBLPEDIDOSCLICAB PC ON S.IDPEDIDOCLI=PC.IDPEDIDOCLI 
    INNER JOIN TBLORDENRECOGIDALIN OL ON S.IDORDENRECOGIDA=OL.IDORDENRECOGIDA AND S.IDPEDIDOCLI=OL.IDPEDIDOCLI AND S.IDPEDIDOCLILIN=OL.IDPEDIDOCLILIN 
    INNER JOIN TBLORDENRECOGIDACAB OC ON OC.IDORDENRECOGIDA = OL.IDORDENRECOGIDA left join dbo.tblcargalin cl on cl.identificador=pl.identificador 
    WHERE PL.IDPACKINGESTADO='PK' AND OC.IDORDENESTADO NOT IN ('PS','PA','PH') and (cl.idcarga is null or ISNULL(s.idcarga,0)=0) 
    order by pc.idpedidocli
  </nivel3>
  <nivel4>
    select distinct PL.IDENTIFICADOR,PL.IDPACKINGLIST,'NIVEL:' + convert (varchar(1), PL.NIVEL),pc.IDPEDIDOCLI 
    FROM dbo.TBLPACKINGLIST PL INNER JOIN  dbo.TBLSALIDAS S ON S.IDENTIFICADORPL = PL.IDENTIFICADOR 
    INNER JOIN dbo.TBLPEDIDOSCLICAB PC ON S.IDPEDIDOCLI=PC.IDPEDIDOCLI 
    INNER JOIN TBLORDENRECOGIDALIN OL ON S.IDORDENRECOGIDA=OL.IDORDENRECOGIDA AND S.IDPEDIDOCLI=OL.IDPEDIDOCLI AND S.IDPEDIDOCLILIN=OL.IDPEDIDOCLILIN 
    INNER JOIN TBLORDENRECOGIDACAB OC ON OC.IDORDENRECOGIDA = OL.IDORDENRECOGIDA left join dbo.tblcargalin cl on cl.identificador=pl.identificador 
    WHERE PL.IDPACKINGLISTPADRE=0 AND OC.IDORDENESTADO NOT IN ('PS','PA','PH') AND PL.IDPACKINGESTADO='PK' and (cl.idcarga is null or ISNULL(s.idcarga,0)=0) 
    UNION 
    Select distinct PLP.IDENTIFICADOR,PLP.IDPACKINGLIST,'NIVEL:' + convert (varchar(1), PLP.NIVEL),pc.IDPEDIDOCLI 
    FROM dbo.TBLPACKINGLIST PL 
    INNER JOIN DBO.TBLPACKINGLIST PLP ON PL.IDPACKINGLISTPADRE=PLP.IDPACKINGLIST AND PLP.NIVEL=2 
    INNER JOIN  dbo.TBLSALIDAS S ON S.IDENTIFICADORPL = PL.IDENTIFICADOR 
    INNER JOIN dbo.TBLPEDIDOSCLICAB PC ON S.IDPEDIDOCLI=PC.IDPEDIDOCLI 
    INNER JOIN TBLORDENRECOGIDALIN OL ON S.IDORDENRECOGIDA=OL.IDORDENRECOGIDA AND S.IDPEDIDOCLI=OL.IDPEDIDOCLI AND S.IDPEDIDOCLILIN=OL.IDPEDIDOCLILIN 
    INNER JOIN TBLORDENRECOGIDACAB OC ON OC.IDORDENRECOGIDA = OL.IDORDENRECOGIDA 
    left join dbo.tblcargalin cl on cl.identificador=pl.identificadoR 
    WHERE PL.IDPACKINGLISTPADRE % 0 AND OC.IDORDENESTADO NOT IN ('PS','PA','PH') AND PL.IDPACKINGESTADO='PK' and (cl.idcarga is null or ISNULL(s.idcarga,0)=0)
  </nivel4>
  <nivel5></nivel5>
  <nivel6></nivel6>
</arbol>